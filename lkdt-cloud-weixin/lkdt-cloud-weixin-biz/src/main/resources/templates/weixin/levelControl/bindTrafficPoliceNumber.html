<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <!-- iphone会把一串数字识别为电话号码，点击的时候会提示是否呼叫，屏蔽这功能则把telephone设置为no -->
    <meta content="telephone=no" name="format-detection" />
    <!-- iphone的私有标签，默认值为default（白色），可以定为black（黑色）和black-translucent（灰色半透明） -->
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!-- iphone设备的是有标签 允许全屏模式浏览，隐藏浏览器导航栏 -->
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <!-- 全屏显示 -->
    <meta content="yes" name="apple-touch-fullscreen" />
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- 屏蔽百度转码 -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>智高速</title>
    <!-- 引入 WeUI -->
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/weui.css"/>
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/weuix.css"/>

    <style>
        a{text-decoration: none;}
        a:hover{text-decoration: none;}
        .police_bind{width: 100%;height: 100%;}
        .police_bind .t{width: 100%;height: 30px;line-height: 30px;text-align: center;}
        .police_bind .f{width: 60%;margin:0 auto;}
		.police_bind .f .i{width: 100%;height: auto;margin:0 auto;}
        .police_bind .f .i img{width: 100%;height: auto;}
        .police_bind .f .i input{padding:4px 0;margin-top:25px;  width:100%; height:1.62857143em; background-color: #FFFFFF; font-size:16px; line-height:1.62857143em; box-sizing:content-box; background:transparent;}
        .police_bind .f .i button{padding:4px 0;margin:15px 0; width:100%; height:1.62857143em; border:none; font-size:18px; line-height:1.62857143em; box-sizing:content-box; background-color: #ee7700;color: white;}
    </style>
</head>
<body>
    <div class="weui-btn_default weui-header ">
        <h1 class="weui-header-title f-green">警号确认</h1>
    </div>
    <div class="police_bind" >
		<!-- <div class="t">您未绑定警号，请先绑定警号</div> -->
		<div class="f">
           	<div class="i"><img alt="" src="/lkdtWX/img/jiaojing.png"></div>
           	<div class="i">
            	<input class="" id="policeId" name="policeId" maxlength="20" placeholder="请输入警号"  />
           	</div>
           	<div class="i">
           		<button type="button" class="btn btn-primary" onclick="fnBind()">警号确认</button>
           	</div>
		</div>
    </div>

    

    <!-- 引入 WeJS -->
    <script src="/lkdtWX/plugins/weui/js/commonMap.js"></script>
    <script src="/lkdtWX/plugins/weui/js/zepto.min.js"></script>
    <script src="/lkdtWX/plugins/weui/js/zepto.weui.js"></script>
    <script src="/lkdtWX/plugins/weui/js/axios.min.js"></script>
    <script>
    	let openid = u.getStorage("openid");
    	let isBindPoliceId = false;	//是否已经绑定警号
    	
    	$(function(){
    		let policeId = getURLParameter("policeId");
    		$("#policeId").val(policeId);
    		if(policeId != null && policeId.length > 0){
    			isBindPoliceId = true;
    		}
        });
    	
        //返回
        function bindBack(){
            window.location.replace("/weixin/map/wxMap");
        }

        function fnBind(){
            //参数
            let policeId = $("#policeId").val();
            if(policeId == null || policeId.length == 0 ){
            	$.toast("请输入警号", "forbidden");
            }else{
            	axios.post('/weixin/trafficPolice/bindTrafficPolice',{policeId:policeId,openid:openid,isBindPoliceId:isBindPoliceId})//也可以直接拼接在url
	                .then(function(rs){
	                    $.hideLoading();
	                    if(rs.data && rs.data.code == 0){
	                        // $.noti({title: "保存成功",time: 2000,});
	                        //$.alert("绑定警号成功", "",function (){
	                        //	bindToadTrafficPoliceBack();
	                        //});
	                    	bindToadTrafficPoliceBack();
	                    } else {
	                        $.toast("警号确认失败", "cancel");
	                    }
	                }).catch(function(e){
	                    $.hideLoading();
	                    $.toast("网络异常", "cancel");
	                });
            }
        }
        
        function bindToadTrafficPoliceBack(){
        	$.showLoading();
            axios.post('/weixin/trafficPolice/bindRoad',{openid:openid})//也可以直接拼接在url
                .then(function(rs){
                    $.hideLoading();
                    if(rs.data){
                        window.location.replace(rs.data);
                    } else {
                        $.toast("跳转失败", "cancel");
                    }
                }).catch(function(e){
                    $.hideLoading();
                    $.toast("网络异常", "cancel");
                });
            
        	//window.location.replace("/weixin/trafficPolice/bindRoad?openid="+openid);
        }
    </script>
</body>
</html>