<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width"> -->
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <!-- iphone会把一串数字识别为电话号码，点击的时候会提示是否呼叫，屏蔽这功能则把telephone设置为no -->
    <meta content="telephone=no" name="format-detection"/>
    <!-- iphone的私有标签，默认值为default（白色），可以定为black（黑色）和black-translucent（灰色半透明） -->
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!-- iphone设备的是有标签 允许全屏模式浏览，隐藏浏览器导航栏 -->
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <!-- 全屏显示 -->
    <meta content="yes" name="apple-touch-fullscreen"/>
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- 屏蔽百度转码 -->
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <title>智高速</title>
    <!-- 引入 bootstrap -->
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/bootstrap.my.icon.css">
    <!-- 引入 WeUI -->
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/weui.css"/>
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/weuix.css"/>
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/zencdn/7.4.1/video-js.css"/>
    <link rel="stylesheet" href="/lkdtWX/plugins/weui/css/gooey.min.css?v=1"/>
    <style>
        html, body, #container {
            width: 100%;
            height: 100%;
        }

        /*地图样式*/
        .amap-zoomcontrol {
            display: none;
        }

        .camimg {
            background: url("/lkdtWX/plugins/weui/img/cam.png");
            background-size: 100%;
            height: 10px;
            width: 10px;
        }

        .button-img {
            width: 24px;
            float: left;
            padding-left: 13px;
            margin-top: 9px;
            padding-right: 13px;
        }

        .p-wind {
            line-height: 10vw;
            padding-left: 5px;
            font-size: 4vw;
        }


        /*******一般异常详情样式 start*****/
        .video-box {
            box-sizing: border-box;
        }

        .swiper-container-android .swiper-slide, .swiper-wrapper {
            -webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            -o-transform: translate(0, 0);
            -ms-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0)
        }

        .swiper-wrapper {
            -webkit-box-lines: multiple;
            -moz-box-lines: multiple;
            -ms-flex-wrap: wrap;
            -webkit-flex-wrap: wrap;
            flex-wrap: wrap
        }

        .swiper-pagination {
            position: absolute;
            text-align: center;
            -webkit-transition: .3s;
            -moz-transition: .3s;
            -o-transition: .3s;
            transition: .3s;
            -webkit-transform: translate3d(0, 0, 0);
            -ms-transform: translate3d(0, 0, 0);
            -o-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
            z-index: 10
        }

        .video-item {
            width: 96% !important;
            margin: 0 auto;
        }

        .swiper-slide {
            -webkit-flex-shrink: 0;
            -ms-flex: 0 0 auto;
            flex-shrink: 0;
            width: 100%;
            height: 100%;
            position: relative
        }

        .video-head, .addr-head {
            display: flex;
            justify-content: space-between;
            border-bottom: 0.01vw solid #f5f5f5;
            padding-bottom: 2vw;
        }

        .head-left {
            display: flex;
            align-items: center;
            width: 100%;
            margin-top: 1vw;
        }

        .head-left img {
            width: 12vw;
            height: 12vw;
            margin-right: 2vw;
        }

        .left-txt {
            display: flex;
            flex-direction: column;
            width: calc(100% - 1rem)
        }

        .left-title {
            font-size: 4.5vw;
            color: #333;
            font-weight: bold;
            margin-bottom: 0.05rem;
        }

        .left-contain {
            font-size: 4vw;
            color: #666;
        }

        .busy-info {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .busy-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 1vw;
        }

        .item-txt12 {
            text-align: center;
            height: 6vw;
            line-height: 6vw;
        }

        .item-txt1 {
            color: #333;
            font-size: 4vw;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .item-txt2 {
            color: #666;
            font-size: 3.5vw;
            margin-top: 0.1rem;
        }

        /*******一般异常详情样式 end*****/
    </style>


    <style type="text/css">

        /*Fontawesome Iconfont*/


        /*Montserrat, Open Sans*/


        /*Hiding the checkbox*/

        #tm {
            display: none;
        }

        /*Content area*/

        section {
            position: relative;
            transition: all 0.25s;
            width: 100%;
            height: 100%;

        }

        section label {
            display: block;
            position: absolute;
            left: 20px;
            bottom: 0px;
            cursor: pointer;
            z-index: 9999;
        }

        /*Nav styles*/
        .leftMenu {
            background: rgb(50, 50, 50);
            width: 120px;
            height: 100%;
            position: absolute;
            display: none;
        }

        .sidenav {
            background: rgb(50, 50, 50);
            width: 120px;
            position: fixed;
            left: 0;
            bottom: 20px;
            display: none;
        }

        .sidenav li {
            list-style-type: none;
        }

        .sidenav a {
            color: white;
            text-decoration: none;
        }

        .sidenav b {

            font: bold 12px/45px Montserrat;
            display: block;

            opacity: 0;
            transform: translateX(50px);
            transition: all 0.4s;

        }

        .sidenav i {
            display: block;
            width: 50px;
            float: left;
            font-size: 16px;
            line-height: 48px;
            text-align: center;
        }

        .sidenav .button-img.two-menu-img {
            width: 23px;
            height: 23px;
            line-height: 26px;
            margin-top: 0px;
            padding-left: 20px;
        }

        .sidenav .two-menu-b {
            height: 26px;
            line-height: 26px;
        }

        /*.sidenav .two-menu-a{display: block;position: relative;top: -10px;}*/


        /*Animation controls using checkbox hack*/

        /*Animate content area to the right*/

        #tm:checked ~ section {
            transform: translateX(120px);
        }

        /*Animate links from right to left + fade in effect*/

        #tm:checked ~ .sidenav b {
            opacity: 1;
            transform: translateX(0);
        }

        #tm:checked ~ .sidenav li:nth-child(1) b {
            transition-delay: 0.08s;
        }

        #tm:checked ~ .sidenav li:nth-child(2) b {
            transition-delay: 0.16s;
        }

        #tm:checked ~ .sidenav li:nth-child(3) b {
            transition-delay: 0.24s;
        }

        #tm:checked ~ .sidenav li:nth-child(4) b {
            transition-delay: 0.32s;
        }

        #tm:checked ~ .sidenav li:nth-child(5) b {
            transition-delay: 0.40s;
        }

        #tm:checked ~ .sidenav li:nth-child(6) b {
            transition-delay: 0.48s;
        }

        #tm:checked ~ .sidenav li:nth-child(7) b {
            transition-delay: 0.56s;
        }

        #tm:checked ~ .sidenav li:nth-child(8) b {
            transition-delay: 0.64s;
        }

        #tm:checked ~ .sidenav li:nth-child(9) b {
            transition-delay: 0.72s;
        }

        .button-img-XV {
            width: 100%;
            float: left;
            padding-left: 0px;
            margin-top: 0px;
            padding-right: 0px;
        }

        .locbox1-defind {
            padding: 5px 5px 5px 5px;
        }

        .locbox1-defind-XV {
            padding: 3px 3px 3px 3px;
        }

        #gooeySVG0 {
            height: 0px;
            width: 0px;
        }

        .navimenu {
            position: relative;
            min-width: 0px;
            min-height: 0px;
            margin: auto auto auto -80px;
            padding-left: 80px;
            box-sizing: border-box;
            text-align: left;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-transform-style: preserve-3d;
            outline: transparent solid 5px;
            transform-style: preserve-3d;
        }

        .tcw-div {
            height: 10vw;
            width: 100%;
            margin: 0;
            background-color: #090a21;
            color: #fff;
            font-family: sans-serif;
        }

        .col-md-3 {
            width: 25%;
            margin: 0;
            float: left;
            min-height: 5px;
        }
    </style>
</head>
<body scoll=no>
<input id="openid" th:value="${openid}" hidden>
<audio id="antongXV" src="" autoplay></audio>
<input type="checkbox" id="tm"/>

<!-- The menu -->
<div class="leftMenu"></div>
<ul id="" class="sidenav" style="top: 5px;">

    <li><a href="#" onclick="btnFun.settingFun()">
        <img src="/lkdtWX/plugins/weui/img/buttons/daolubangding.png?v=2" class="button-img"></img><b>路段绑定</b>
    </a></li>
</ul>
<ul id="sidenav" class="sidenav" style="    height: 85vh;
    overflow-y: scroll;
    top: 15vh;
}">

    <li>
        <a href="#" onclick="btnFun.tongxingfengxianFun(this)"><img
                src="/lkdtWX/plugins/weui/img/buttons/tongxingfengxian.png?v=3" class="button-img"></img><b>通行风险</b></a>
        <div id="two-menu-txfx" style="display: none;">
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/sansefenbu.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">三色分布</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/weiguichaosu.png?v=2"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">违规超速</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/weiguidisu.png?v=2"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">违规低速</b></a>
            <a href="#" onclick="" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/weizhangzhandao.png?v=2"
                    class="button-img two-menu-img"></img><b class="two-menu-b">违章占道</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/weiguibiandao.png?v=2"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">违规变道</b></a>
        </div>
    </li>

    <li>
        <a href="#" onclick="btnFun.tfwqFun(this)"><img src="/lkdtWX/plugins/weui/img/buttons/tufaweiqing1.png?v=2"
                                                        class="button-img"></img><b>突发危情</b></a>
        <div id="two-menu-tfwq" style="display: none;">
            <a href="#" onclick="btnFun.showVideoPopFun()" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/tufaweiqing.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">突发事件</b></a>
            <a href="#" onclick="btnFun.showFogFun(this, '现无团雾事件')" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/tufatuanwu.png?v=2" class="button-img two-menu-img"></img><b
                    class="two-menu-b">突发团雾</b></a>
        </div>
    </li>

    <li><a href="#" onclick=""><img src="/lkdtWX/plugins/weui/img/buttons/dinengjiandu.png?v=2"
                                    class="button-img"></img><b>低能见度</b></a></li>
    <li><a href="#" onclick="btnFun.yongduyujingFun(this)">
        <img src="/lkdtWX/plugins/weui/img/buttons/yongduyujing.png?v=2" class="button-img"></img><b>拥堵预警</b>
    </a>
        <div id="two-menu-ydyj" style="display: none;">
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/yongduyugao.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">拥堵预告</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/xiaodujuece.png?v=2"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">消堵决策</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/xiaoduyugao.png?v=2"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">消堵预告</b></a>
        </div>
    </li>
    <li><a href="#" onclick="btnFun.showFogFun(this, '现无合流区预警')"><img
            src="/lkdtWX/plugins/weui/img/buttons/heliuqu_gray.png?v=3" class="button-img"></img><b>合流预警</b></a></li>

    <li><a href="#" onclick="btnFun.showWindFun(this)"><img src="/lkdtWX/plugins/weui/img/buttons/dafeng.png?v=2"
                                                            class="button-img"></img><b>大风预警</b></a></li>

    <li><a href="#" onclick="btnFun.luqiaobingxueFun()"><img
            src="/lkdtWX/plugins/weui/img/buttons/luqiaobingxue.png?v=2" class="button-img"></img><b>路桥冰雪</b></a>
        <div id="two-menu-lqbx" style="display: none;">
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/jiebingfengxian.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">路面湿滑</b></a>
            <a href="#" onclick="" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/bingxuexiaorong.png?v=2"
                    class="button-img two-menu-img"></img><b class="two-menu-b">冰雪消融</b></a>
        </div>
    </li>


    <li>
        <a href="#" onclick="btnFun.wulilukuangFun(this)"><img
                src="/lkdtWX/plugins/weui/img/buttons/xianxingxingzhuang.png?v=3"
                class="button-img"></img><b>线形性状</b></a>
        <div id="two-menu-wllk" style="display: none;">
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/daoluxianxing_gray.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">坡道弯道</b></a>
            <a href="#" onclick="" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/suidaoqiaoliang_gray.png"
                    class="button-img two-menu-img"></img><b class="two-menu-b">隧道桥梁</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/lucebiaoshi_gray.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">标志标识</b></a>
            <a href="#" onclick="" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/lumianxingzhuang_gray.png"
                    class="button-img two-menu-img"></img><b class="two-menu-b">路面品质</b></a>
        </div>
    </li>
    <li>
        <a href="#" onclick="btnFun.roadConditionFun(this)"><img
                src="/lkdtWX/plugins/weui/img/buttons/jingtailuzhang.png?v=3" class="button-img"></img><b>路障警示</b></a>
        <div id="two-menu-lkbb" style="display: none;">
            <a href="#" onclick="btnFun.showPlanExceptionfun(this)" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/daoluweixiu_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">路面施工</b></a>
            <a href="#" onclick="btnFun.showAccidentExceptionfun(this)" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/shigupaizhang_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">事故清排</b></a>
            <a href="#" onclick="btnFun.showVehicleFaultExceptionfun(this)" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/luceyanghu_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">路侧施工</b></a>
        </div>
    </li>
    <li>
        <a href="#" onclick="btnFun.dongtaitongzhiFun(this)"><img
                src="/lkdtWX/plugins/weui/img/buttons/dongtaitongzhi.png?v=3" class="button-img"></img><b>交管通知</b></a>
        <div id="two-menu-dttz" style="display: none;">
            <a href="#" onclick="btnFun.showFogFun(this, '暂未接入数据')" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/kebianxiansu_gray.png"
                    class="button-img two-menu-img"></img><b class="two-menu-b">可变限速</b></a>
            <a href="#" onclick="btnFun.showFogFun(this, '暂未接入数据')" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/kebianchedao_gray.png"
                    class="button-img two-menu-img"></img><b class="two-menu-b">可变车道</b></a>
            <a href="#" onclick="btnFun.showFogFun(this, '暂未接入数据')" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/LEDfabu_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">LED发布</b></a>
        </div>
    </li>

    <li>
        <a href="#" onclick="btnFun.ssnFun(this)"><img src="/lkdtWX/plugins/weui/img/buttons/shuangshiniao.png?v=3"
                                                       class="button-img"></img><b>双时鸟</b></a>
        <div id="two-menu-ssn" style="display: none;">
            <a href="#" onclick="" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/chezaishuangshiniao.png"
                    class="button-img two-menu-img"></img><b class="two-menu-b">车载双时鸟</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/APPshuangshiniao.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">APP双时鸟</b></a>
            <a href="#" onclick="" class="two-menu-a"><img src="/lkdtWX/plugins/weui/img/buttons/luceshuangshiniao.png"
                                                           class="button-img two-menu-img"></img><b class="two-menu-b">路侧双时鸟</b></a>
        </div>
    </li>

    <li><a href="#" onclick="btnFun.showAreaFun(this)"><img src="/lkdtWX/plugins/weui/img/buttons/fuwuqu.png?v=3"
                                                            class="button-img"></img><b>服务区</b></a></li>

    <!--<li><a href="#" onclick="btnFun.antongXV()"><img src="/lkdtWX/plugins/weui/img/buttons/antong.png?v=2" class="button-img" ></img><b>安通小V</b></a></li>-->

    <li id="yichangjiankong">
        <a href="#" onclick="btnFun.yichangjiankongFun(this)"><img
                src="/lkdtWX/plugins/weui/img/buttons/yichangjiankong.png?v=2" class="button-img"></img><b>系统诊断</b></a>
        <div id="two-menu-xtzd" style="display: none;">
            <a href="#" onclick="btnFun.cameraAbn()" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/shexiangji_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">摄像机</b></a>
            <a href="#" onclick="btnFun.nofun()" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/leida_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">雷达</b></a>
            <a href="#" onclick="btnFun.nofun()" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/chuanganqi_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">其它传感器</b></a>
            <a href="#" onclick="btnFun.dailyPaper()" class="two-menu-a"><img
                    src="/lkdtWX/plugins/weui/img/buttons/tiqvribao_gray.png" class="button-img two-menu-img"></img><b
                    class="two-menu-b">提取日报</b></a>
        </div>
    </li>

</ul>

<!-- Content area -->

<section>

    <label for="tm" style="bottom: 20px;">
        <img src="/lkdtWX/plugins/weui/img/buttons/menu.png" style="height: 40px">
    </label>

    <div id="container"></div>

</section>

<nav id="gooey-h" style="position: absolute;bottom:0px;z-index: 999;width: 50px;height:50px;right: 50px;">
    <input type="checkbox" class="menu-open" name="menu-open2" id="menu-open2"/>
    <label class="open-button" for="menu-open2">
        <!--<span class="burger burger-1"></span>
        <span class="burger burger-2"></span>
        <span class="burger burger-3"></span>-->
        <div class="locbox1-defind-XV"><img src="/lkdtWX/plugins/weui/img/buttons/antongXV.png?v=2"
                                            class="button-img-XV"></img></div>
    </label>

    <a href="#" class="gooey-menu-item" direction="horizontal" onclick="btnFun.antongXV(2)">
        <div class="amap-geolocation-con">
            <div class="locbox1-defind">
                <img src="/lkdtWX/plugins/weui/img/buttons/antongC.png" class="button-img-XV" aria-hidden="true"
                     onclick="btnFun.nofun()"></img>
            </div>
        </div>
    </a>

    <a href="#" class="gooey-menu-item" direction="horizontal" onclick="btnFun.antongXV(1)">
        <div class="amap-geolocation-con">
            <div class="locbox1-defind">
                <img src="/lkdtWX/plugins/weui/img/buttons/antongB.png" class="button-img-XV"
                     onclick="btnFun.showWindFun(this)"></img>
            </div>
        </div>
    </a>

    <a href="#" class="gooey-menu-item" direction="horizontal" onclick="btnFun.antongXV(0)">
        <div class="amap-geolocation-con">
            <div class="locbox1-defind">
                <img src="/lkdtWX/plugins/weui/img/buttons/antongA.png" class="button-img-XV" aria-hidden="true"
                     onclick="btnFun.nofun()"></img>
            </div>
        </div>
    </a>
</nav>

<div id="wxEquPopDiv" style="display: none;position: fixed;top:0px;width:100%;background-color: #132535;z-index: 9999;">
    <img src="/lkdtWX/img/youwu.jpg" class="img-max" onclick="wxEquPop.previewFun(this);return false;"
         style="width:100%;max-height: 300px;"/><!--onload="wxEquPop.imgLoad()"-->
    <div class="echarts" id="echarts-line-chart" style="height: 200px;"></div>
    <!-- <a href="javascript:;" class="weui-btn weui-btn_danger" id="confirmPhoneMonual" style="background-color: #ed5565;display: none" onclick="confirmPhoneMonual()">手动告警</a> -->
    <a href="javascript:;" class="weui-btn weui-btn_danger" id="manualCorrection"
       style="background-color: #ed5565;display: none" onclick="manualCorrection()">人工校正</a>
    <a href="javascript:;" class="weui-btn weui-btn_primary"
       style="background-color: #07C060;font-weight: bold;letter-spacing: 3px;!important;"
       onclick="wxEquPop.close()">关闭</a>
</div>

<div id="wxWindPopDiv" style="display: none;position: fixed;top:0px;width:100%;background-color: #132535;z-index: 10;">
    <div class="row" style="height: 20vw;width: 100%;    margin: 0;">
        <div class="col-md-6" style="    background-color: #090a21;
    color: #fff;  font-size: 15px;padding: 0px;height: 100%;    padding-left: 0px;width: 50%;float: left;    font-family: sans-serif;">
			<span>
				<p class="p-wind">当前风速：<span id="mi"></span>m/s（<span id="windLevel"></span>）</p>
	 			<p class="p-wind">当前风向：<span id="fengxiang"></span> </p>
			</span>
        </div>
        <div class="col-md-6" style="    background-color: #090a21;
    color: #fff;  font-size: 15px;padding: 0px;height: 100%;    padding-left: 0px;width: 50%;float: left;    font-family: sans-serif;">
			<span>
				<p class="p-wind">今日最大风速：<span id="maxDay"></span>m/s </p>
				<p class="p-wind">今日最小风速：<span id="minDay"></span>m/s </p>
			</span>
        </div>
    </div>
    <div class="row" style="height: 30%;width: 99%;">
        <img id="windImg" src="" class="img-max" onclick="wxEquPop.previewFun(this);return false;"
             style="width:100%;max-height: 300px;">
    </div>
    <div class="row" style="height: 50%;width: 99%;margin-top: 3%;">
        <div id="container2" class="echarts" style="height: 100%;width: 100vw;height: 200px;"></div>
    </div>

    <a href="javascript:;"
       style="margin-top: 10px;background-color: #07C060;font-weight: bold;letter-spacing: 3px;!important;"
       class="weui-btn weui-btn_primary" onclick="wxWindPop.close()">关闭</a>
</div>
<div id="wxAreaPopDiv" style="display: none;position: fixed;top:0px;width:100%;background-color: #132535;z-index: 10;">
    <div class="row" style="width: 99%;">
        <img id="windImg" src="" class="img-max" onclick="wxEquPop.previewFun(this);return false;"
             style="width:100%;max-height: 300px;">
    </div>
    <div class="row tcw-div" style="">
        <div class="col-md-3">
            <span>			</span>
        </div>
        <div class="col-md-3">
            已使用<span></span>
        </div>
        <div class="col-md-3">
            总车位<span></span>
        </div>
        <div class="col-md-3">
            比例<span></span>
        </div>
    </div>
    <div class="row tcw-div" style="">
        <div class="col-md-3">
            小客车<span>			</span>
        </div>
        <div class="col-md-3">
            51<span></span>
        </div>
        <div class="col-md-3">
            200<span></span>
        </div>
        <div class="col-md-3">
            25%<span></span>
        </div>
    </div>
    <div class="row tcw-div" style="">
        <div class="col-md-3">
            大客车<span>			</span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
    </div>
    <div class="row tcw-div" style="">
        <div class="col-md-3">
            危化品车<span>			</span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
        <div class="col-md-3">
            0<span></span>
        </div>
    </div>
    <div class="row" style="height: 50%;width: 99%;margin-top: 3%;">
        <div id="container2" class="echarts" style="height: 100%;width: 100vw;height: 200px;"></div>
    </div>
    <a href="javascript:;"
       style="margin-top: 10px;background-color: #f8ac59;font-weight: bold;letter-spacing: 3px;!important;"
       class="weui-btn weui-btn_primary" onclick="wxAreaPop.jicha()">服务区稽查</a>
    <a href="javascript:;"
       style="margin-top: 10px;background-color: #f8ac59;font-weight: bold;letter-spacing: 3px;!important;"
       class="weui-btn weui-btn_primary" onclick="wxAreaPop.fangxiehuo()">服务区防卸货</a>
    <a href="javascript:;"
       style="margin-top: 10px;background-color: #07C060;font-weight: bold;letter-spacing: 3px;!important;"
       class="weui-btn weui-btn_primary" onclick="wxAreaPop.close()">返回</a>
</div>

<div id="wxEquPop_preview" class="weui-gallery" style="display: none; z-index: 10000;"
     onclick="wxEquPop.wxEquPop_preview_close()">
    <span class="weui-gallery__img" style="background-image:url(/img/youwu.jpg)"></span>
</div>

<div id="wxExceptioPopDiv"
     style="display: none;position: fixed;top:0px;width:100%;background-color: #f9f9f9;z-index: 10000;">
    <div class="video-box"></div>
    <a href="javascript:;"
       style="margin-top: 10px;background-color: #07C060;font-weight: bold;letter-spacing: 3px;!important;"
       class="weui-btn weui-btn_primary" onclick="wxExceptioPop.close()">关闭</a>
</div>

<div id="rgjz" style="z-index: 10000;" class="weui-popup__container">
    <div class="weui-popup__overlay"></div>
    <div class="weui-popup__modal">
        <iframe width="100%;" height="90%;" id="rgjzIfram" name="ifram" style="border:none;margin-top: 0px;"></iframe>
    </div>
</div>
<!-- 引入 WeJS -->
<script src="/lkdtWX/plugins/weui/jquery-weui/js/jquery.min.js" charset="utf-8"></script>

<script src="/lkdtWX/plugins/weui/js/commonMap.js"></script>
<!-- <script src="/lkdtWX/plugins/weui/js/zepto.min.js"></script> -->
<!-- <script src="/lkdtWX/plugins/weui/js/zepto.weui.js"></script> -->
<script src="/lkdtWX/plugins/weui/jquery-weui/js/jquery-weui.min.js"></script>
<script src="/lkdtWX/plugins/weui/js/axios.min.js"></script>
<!--<script src="/lkdtWX/plugins/weui/js/echarts-all.js"></script>-->
<script src="/lkdtWX/js/plugins/echarts/echarts.min.js"></script>
<script src="/lkdtWX/js/common-options.js?v=2"></script>
<script src="/lkdtWX/plugins/weui/jweixin/jweixin-1.4.0.js"></script>

<!--视频播放-->
<script src="/lkdtWX/js/ckplayer/ckplayer.min.js?v=1"></script>
<script src="/lkdtWX/js/appjs/weixin/map/videoPop.js?v=4"></script>

<script src="/lkdtWX/plugins/weui/js/gooey.js?v=1"></script>

<script src="/lkdtWX/plugins/weui/js/roadException/roadException.js?v=1"></script>
<script src="/lkdtWX/fog/js/polygonData.js"></script>
<script src="https://webapi.luokuang.com/maps?ak=DE16202822122344764353E75FDD9F47EE8041388A0DEAB8126ML9OUFMZS1953"></script>
<script src="https://webapi.luokuang.com/mapvgl?ak=DE16202822122344764353E75FDD9F47EE8041388A0DEAB8126ML9OUFMZS1953"></script>

<!--视频播放-->
<!--<script src="/lkdtWX/plugins/weui/zencdn/7.4.1/video.js"></script>-->
<!-- script src="/lkdtWX/plugins/weui/zencdn/videojs-contrib-hls-5.15.0/videojs-contrib-hls.min.js"></script-->
<!--debuger-->
<!-- <script src="/lkdtWX/plugins/weui/js/eruda.js"></script> -->
<script>
    var clickepId = '';
    var user = "";
    var sidebarHTML = "";
    var lineChart = echarts.init(document.getElementById("echarts-line-chart"));
    var clickMassMarks = {};

    function initMenu() {
        $("#gooey-h").gooeymenu({
            bgColor: "white",
            contentColor: "black",
            style: "horizontal",
            bounce: true,
            horizontal: {
                menuItemPosition: "glue"
            },
            circle: {
                radius: 50
            },
            margin: "small",
            size: 50,
            bounceLength: "small",
            transitionStep: 100
        });
        //$("#menu-open2").click();
    }

    $(function () {
        mapInit();
        u.setStorage("openid", $("#openid").val());
        $("#yichangjiankong").hide();
        $.ajax({
            type: "post",
            url: "/weixin/wxLogin",
            data: {"openid": $("#openid").val()},
            async: false,
            dataType: "json",
            success(message) {
                u.setStorage("token", message.result.token);
                //获取路段摄像头数据
                equipmentList($("#openid").val());
                initMenu();
                initHighways();

                //大风点
                // windTestInit();
                areaTestInit();

                if (/android/i.test(navigator.userAgent)) {
                    // 安卓手机
                    user = "1";
                }
                if (/ipad|iphone|mac/i.test(navigator.userAgent)) {
                    //  苹果手机
                    user = "0";
                }

                $('.leftMenu').show();
                $('.sidenav').show();

                let tagid_list = message.result.wxUserInfo.tagid_list || "";
                if (tagid_list.indexOf(101) > -1 || tagid_list == 101) {
                    //$("#confirmPhoneMonual").show();
                    $("#manualCorrection").show();
                    u.setStorage("isAdmin", 1);
                    $("#yichangjiankong").show();
                }

            }
        });


    });

    function wxLogin() {
        //初始化openid
        //初始化openid

    }

    var $src = '';
    var wxEquPop = {
        test: function () {
        },
        /**弹出框能见度*/
        pop: function (equObj) {
            $.ajax({
                url: '/weixin/lookup/updateimgpath/' + equObj.epId,
                type: 'post',
                dataType: 'json',
                headers: {
                    "X-Access-Token": u.getStorage("token")
                },
                success: function (data) {
                    //清除路径
                    if (data.fMeter || equObj.equName.indexOf('路段') >= 0) {
                        $.showLoading();
                        try {
                            //获取图片
                            $src = data.imgpath;
                            clickepId = equObj.epId;
                            $('#wxEquPopDiv').find('img')[0].src = $src;
                            $('#wxEquPop_preview').find('span')[0].style.backgroundImage = 'url("' + $src + '")';
                            //摄像头能见度统计
                            let date = new Date(new Date().getTime() - 24 * 60 * 60 * 1000).Format('yyyy-MM-dd hh:mm:ss');
                            //摄像头能见度统计
                            axios.post('/weixin/map/getDisplayDistanceByEqu', {
                                    openid: u.getStorage("openid"),
                                    epId: equObj.epId,
                                    date: date
                                },
                                {
                                    headers: {
                                        "X-Access-Token": u.getStorage("token")
                                    }
                                })//也可以直接拼接在url
                                .then(function (rs) {
                                    console.log(rs)
                                    if (rs.data || equObj.equName.indexOf('路段') >= 0) {

                                        $('#videoWindow').hide();
                                        $('#wxEquPopDiv').show();
                                        common_options_wx.title.text = equObj.equName;
                                        let echartsData = JSON.parse(rs.data.result);
                                        let currDistance = echartsData.series.split(",")[echartsData.series.split(",").length - 1];
                                        if (currDistance != "" && currDistance != null && currDistance != undefined) {
                                            if (currDistance == 500) {
                                                common_options_wx.title.text += "【当前:" + ">500米】";
                                            } else {
                                                common_options_wx.title.text += "【当前:" + currDistance + "米】";
                                            }

                                        }
                                        common_options_wx.xAxis[0].data = echartsData.xAxis.split(",");
                                        var seriesData = echartsData.series.split(",");
                                        for (var i = 0; i < seriesData.length; i++) {
                                            // if (seriesData[i] <= 30) {
                                            //     seriesData[i] = parseInt(seriesData[i] / 0.3);
                                            // } else if (seriesData[i] <= 50) {
                                            //     seriesData[i] = parseInt(seriesData[i] / 0.25);
                                            // } else if (seriesData[i] <= 100) {
                                            //     seriesData[i] = parseInt(seriesData[i] * 3);
                                            // } else if (seriesData[i] <= 200) {
                                            //     seriesData[i] = parseInt(seriesData[i] / 0.5);
                                            // } else {
                                            //     seriesData[i] = parseInt((parseInt(seriesData[i]) + 200));
                                            // }
                                            seriesData[i] = convertToData(seriesData[i]);
                                        }
                                        common_options_wx.series[0].data = seriesData;
                                        lineChart.setOption(common_options_wx);
                                        try {
                                            let imgpathsjson = echartsData.imgpaths;
                                            lineChart.getZr().off('click');
                                            lineChart.getZr().on('click', function (params) {
                                                let pointInPixel = [params.offsetX, params.offsetY];
                                                if (lineChart.containPixel('grid', pointInPixel)) {
                                                    /*此处添加具体执行代码*/
                                                    let pointInGrid = lineChart.convertFromPixel({seriesIndex: 0}, pointInPixel);
                                                    //X轴序号
                                                    let xIndex = pointInGrid[0];
                                                    //获取当前图表的option
                                                    let op = lineChart.getOption();
                                                    //获得图表中我们想要的数据
                                                    let time = op.xAxis[0].data[xIndex];
                                                    let value = op.series[0].data[xIndex];
                                                    time = time.replace(":", "");
                                                    let date = new Date();
                                                    var hour = date.getHours();
                                                    var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                                                    var hm = hour + "" + minute;
                                                    if (Number(hm) < Number(time)) {
                                                        var yesterdaytime = (new Date).getTime() - 24 * 60 * 60 * 1000;
                                                        date = new Date(yesterdaytime);
                                                    }
                                                    let dateStr = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
                                                    $src = imgpathsjson[time];
                                                    $('#wxEquPopDiv').find('img')[0].src = $src;
                                                    $.showLoading("加载中");
                                                    setTimeout(function () {
                                                        $.hideLoading();
                                                    }, 1000);
                                                }
                                            });
                                        } catch (e) {
                                            console.log(e);
                                        }
                                    }
                                    lineChart.resize();
                                    $.hideLoading();
                                }).catch(function (e) {
                                console.log(e);
                                $.hideLoading();
                            });
                        } catch (e) {
                            $.toast("ERROR:PO215网络异常", "forbidden");
                            $.hideLoading();
                        }
                    } else {
                        $.toast("前端监控平台维护中", "cancel");
                        setTimeout(function () {
                            $(".weui-mask_transparent").remove();
                            $(".weui-toast--visible").removeClass("weui-toast--visible").transitionEnd(function () {
                                var $this = $(this);
                                $this.remove();
                            });
                        }, 500);
                    }
                }
            });

        },
        imgLoad: function () {
            $.hideLoading();
        },
        previewFun: function (ele) {
            $('#wxEquPop_preview').find('span')[0].style.backgroundImage = 'url("' + $src + '")';
            $('#wxEquPop_preview').show();
        },
        wxEquPop_preview_close: function () {
            $('#wxEquPop_preview').hide();
        },
        close: function () {
            $('#wxEquPopDiv').hide();
        },
    };

    let markEqu = null;
    let markFog = null;
    let markFogEnd = null;

    function mapInit() {
        //江苏：{zoom:7,center:[119.167147,32.952384]}
        //东部高速：{zoom:9,center:[119.178133,34.596076]}
        let liveAddress = $('#liveAddress').val();
        let liveAddressJSON = {zoom: 6, center: [119.167147, 32.952384]};
        try {
            let liveAddressJSON$temp = eval('(' + liveAddress + ')');
            if (liveAddressJSON$temp) {
                liveAddressJSON = liveAddressJSON$temp;
            }
        } catch (e) {
            console.log(e);
            liveAddressJSON = {zoom: 6, center: [119.167147, 32.952384]};
        }

        let map$zoom = liveAddressJSON.zoom;
        let map$center = liveAddressJSON.center;//初始地图中心点 江苏[119.117709,33.136569]  连云港[119.178133,34.596076 ]
        //创建地图
        map = new LKMap.Map("container", {
            center: new LKMap.LngLat(map$center[0], map$center[1]),
            zoom: map$zoom,
            style: "lkmap://styles/2fa78e827f8345f3b5a1b92870bf60ec",
            minZoom: 5,
            maxZoom: 12,
        })

        map.on('load', function () {
            addGeojsonPolygon();

            // 添加热力图
            //初始化heatmap对象
            heatmap = new mapvgl.HeatmapLayer({
                map: map,
                style: {
                    color: {
                        0.0: 'rgba(0, 0, 255, 0.0)',
                        0.1: 'rgb(244,235,5)',
                        0.2: 'rgb(244,213,5)',
                        0.3: 'rgb(244,179,5)',
                        0.6: 'rgb(255,147,8)',
                        1.0: '#9a1200'
                    },
                    opacity: 1,
                    radius: 15,
                    weight: 1
                },
                zIndex: 111
            });

            heatmap.addLayer();

            //初始化heatmap对象
            baseHeatmap = new mapvgl.HeatmapLayer({
                map: map,
                style: {
                    color: {
                        0.0: 'rgba(0, 0, 255, 0.0)',
                        1.0: 'rgba(47,252,5,0.3)'
                    },
                    opacity: 1,
                    radius: 15,
                    weight: 1
                },
                zIndex: 90
            });
            baseHeatmap.addLayer();

            map.on('zoomend', function (e) {
                let zoom = Math.floor(map.getZoom()); //获取当前地图级别
                // alert(map.getZoom());
                mapBatchMark(u.getStorage("mass-markers"))
                let vs = $(".camimg");
                if (zoom > 6) {
                    vs.css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                } else {
                    vs.css({height: '10px', width: '10px'});
                }

                //一般异常图标缩放
                if (isZoomchange) {
                    //施工
                    let planArrData = u.getStorage("planArrData");
                    if (planExceptionMarkers) {
                        planExceptionMarkers = [];
                    }
                    //道路管制
                    let roadArrData = u.getStorage("roadArrData");
                    if (roadExceptionMarkers) {
                        roadExceptionMarkers = [];
                    }
                }

                //道路维修
                if (isPlanZoomchange) {
                    let planArrData = u.getStorage("planArrData");
                    if (planExceptionMarkers) {
                        planExceptionMarkers = [];
                    }
                }

                //事故排障
                if (isAccidentZoomchange) {
                    let accidentArrData = u.getStorage("accidentArrData");
                    if (accidentExceptionMarkers) {
                        accidentExceptionMarkers = [];
                    }
                    accidentExceptionMarkers = mapBatchMarkAccidentSetStyle(accidentArrData);
                }
            });
        });


        ////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////地图渲染开始////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////


        uWeb.setStorage("showInfoData", []);
        uWeb.setStorage("mapEquipmentsInitData", []);
        uWeb.setStorage("showInfoSub_routeData", []);

        //告警信息刷新
        //摄像头初始化


        //告警信息渲染

        //告警路径渲染

    }

    function initPage(DistrictExplorer) {
        //创建一个实例getOpenFid
        let districtExplorer = new DistrictExplorer({
            map: map
        });
        let countryCode = 320000, //全国
            provCodes = [],
            cityCodes = [];

        districtExplorer.loadMultiAreaNodes([countryCode].concat(cityCodes),//只需加载全国和市，全国的节点包含省级
            function (error, areaNodes) {
                let countryNode = areaNodes[0], cityNodes = areaNodes.slice(1);
                let path = [];
                //首先放置背景区域，这里是大陆的边界
                path.push(getLongestRing(countryNode.getParentFeature()));

                for (var i = 0, len = provCodes.length; i < len; i++) {
                    //逐个放置需要镂空的省级区域
                    path.push.apply(path, getAllRings(countryNode.getSubFeatureByAdcode(provCodes[i])));
                }
                for (var i = 0, len = cityNodes.length; i < len; i++) {
                    //逐个放置需要镂空的市级区域
                    path.push.apply(path, getAllRings(cityNodes[i].getParentFeature()));
                }
            }
        );
    }

    function getLongestRing(feature) {
        let rings = getAllRings(feature);
        rings.sort(function (a, b) {
            return b.length - a.length;
        });
        return rings[0];
    }

    function getAllRings(feature) {
        let coords = feature.geometry.coordinates,
            rings = [];
        for (let i = 0, len = coords.length; i < len; i++) {
            rings.push(coords[i][0]);
        }
        return rings;
    }


    //js-sdk
    wx.error(function (res) {
        // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
        $.toast("ERROR:PO216微信授权异常", "forbidden");
    });

    // 使用one绑定事件，触发一次即解绑
    $(document).one('click touchstart', document.body, function () {
        let audios = document.getElementsByTagName('audio');
        for (let i = 0, len = audios.length; i < len; i++) {
            audios[i].load();
            audios[i].pause();
        }
    });

    let isLoadException = true;
    let isLoadPlanException = true;
    let isLoadAccidentException = true;

    //设置
    let btnFun = {
        nofun: function () {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $.toast("系统优化中", "cancel");
        },
        cameraAbn: function () {
            window.location.replace("/weixin/cameraAbnormal");
        },
        dailyPaper: function () {
            window.location.replace("/weixin/zhiBan/dailyPaper");
        },
        settingFun: function () {
            window.location.replace("/weixin/map/bindRoadMulti_v2");
            return;
        },
        toggle: function (btn) {
            var pgname = btn.attr("src");
            if (btnFun.isEctive(btn)) {
                pgname = pgname.replace(".png", "_gray.png");
            } else {
                pgname = pgname.replace("_gray.png", ".png");
            }
            btn.attr("src", pgname);
        },
        isEctive: function (btn) {
            var pgname = btn.attr("src");
            if (pgname.indexOf("_gray.png") > 0) {
                return false;
            }
            return true;
        },
        showLoading: function () {
            $.showLoading("");
            setTimeout(function () {
                $.hideLoading();
            }, 3000);
        },
        antongXV: function (index) {
            $.showLoading("安通小V智能语音");
            setTimeout(function () {
                $.hideLoading();
            }, 3000);
            let media = document.getElementById("antongXV");
            let random = Math.floor(Math.random() * 3);
            //TODO delete demo
            let randomMp3 = ["A.mp3", "B.mp3", "C.mp3"]
            media.src = "/lkdtWX/plugins/weui/img/mp3/" + randomMp3[index];
            let playPromise = media.play();
            if (playPromise) {
                playPromise.then(() => {
                    setTimeout(() => {
                        // 后续操作
                        console.log("done");
                    }, media.duration * 1000 + 2); // 为音频的时长单位为秒
                }).catch((e) => {
                    $.showLoading("操作太频繁请重试");
                    console.log(e);
                    setTimeout(function () {
                        $.hideLoading();
                    }, 3000);
                });
            }
        },
        /**展示雾*/
        showFogFun: function (btn, msg) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();

            btnFun.showLoading();
            var btn = $(btn).children("img");
            btnFun.toggle(btn);
            var isEctive = btnFun.isEctive(btn);
            if (isEctive) {
                alarmHandle(true, msg);
            } else {
            }


        },
        /**展示风*/
        showWindFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();

            var btn = $(btn).children("img");
            var pgname = btn.attr("src");
            btnFun.toggle(btn);
            if (!btnFun.isEctive(btn)) {
                if (windMarkers) {
                    windMarkers["blue"].hide();
                    windMarkers["yellow"].hide();
                    windMarkers["red"].hide();
                    windMarkers["weijieru"].hide();
                }
            } else {
                if (windMarkers) {
                    windMarkers["blue"].show();
                    windMarkers["yellow"].show();
                    windMarkers["red"].show();
                    windMarkers["weijieru"].show();
                }
            }
        },
        /**展示服务区*/
        showAreaFun: function (btn) {
            var btn = $(btn).children("img");
            var pgname = btn.attr("src");
            btnFun.toggle(btn);
            if (!btnFun.isEctive(btn)) {
                if (areaMarkers) {
                    areaMarkers.hide();
                }
            } else {
                if (areaMarkers) {
                    areaMarkers.show();
                }
            }
        },
        /**展示摄像头*/
        showVideoFun: function () {
            btnFun.showLoading();
            if ($('#showVideoFun').css('color') != 'gray') {
                // if(all_Equipments){all_Equipments = [];}
                if (all_Equipments) {
                    all_Equipments.hide();
                }
                $('#showVideoFun').css("color", "gray");
            } else {
                // equipmentList(u.getStorage("openid"));
                if (all_Equipments) {
                    all_Equipments.show();
                }
                $('#showVideoFun').css("color", "");
            }
        },
        /**展示服务区*/
        showServiceAreaFun: function () {
            btnFun.showLoading();
            alert("暂无服务区数据");
        },
        /**展示突发危情*/
        showVideoPopFun: function () {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();

            //btnFun.showLoading();
            videoPop();//展示突发危情视频
        },
        showSettingIsShowAttention: function () {
            equipmentList(u.getStorage("openid"));
            if (btnFun.getShowSetting('isShowAttention')) {
                $('#showVideoFun').css("color", "");
            } else {
                $('#showVideoFun').css("color", "gray");
            }
        },
        /**一般异常**/
        showExceptionfun: function (btn) {
            var btn = $(btn).children("img");
            var pgname = btn.attr("src");
            btnFun.toggle(btn);
            if (isLoadException) {	//第一次加载
                btnFun.showLoading();
                eventMore('1006002,1006006');
                isShowException = false;
                $.hideLoading("");
            } else {	//显示数据/隐藏数据
                if (!btnFun.isEctive(btn)) {
                    planExceptionMarkers.hide();
                    roadExceptionMarkers.hide();
                    wxExceptioPop.close();
                } else {
                    planExceptionMarkers.show();
                    roadExceptionMarkers.show();
                }
            }
        },
        /**路况播报**/
        roadConditionFun: function (btn) {
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-lkbb").toggle();
        },
        /**异常监控**/
        yichangjiankongFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-xtzd").toggle();
        },
        /**双时鸟**/
        ssnFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-ssn").toggle();
        },
        /**突发危情**/
        tfwqFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-tfwq").toggle();
        },
        /**物理路况**/
        wulilukuangFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-wllk").toggle();
        },
        /**动态通知**/
        dongtaitongzhiFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-dttz").toggle();
        },

        /**通行风险**/
        tongxingfengxianFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-txfx").toggle();
        },
        /**拥堵预警**/
        yongduyujingFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-lqbx").hide();
            $("#two-menu-ydyj").toggle();
        },
        /**路桥冰雪**/
        luqiaobingxueFun: function (btn) {
            $("#two-menu-lkbb").hide();
            $("#two-menu-xtzd").hide();
            $("#two-menu-ssn").hide();
            $("#two-menu-tfwq").hide();
            $("#two-menu-wllk").hide();
            $("#two-menu-dttz").hide();
            $("#two-menu-txfx").hide();
            $("#two-menu-ydyj").hide();
            $("#two-menu-lqbx").toggle();
        },
        /**道路维修**/
        showPlanExceptionfun: function (btn) {
            var btn = $(btn).children("img");
            var pgname = btn.attr("src");
            btnFun.toggle(btn);
            if (isLoadPlanException) {	//第一次加载
                btnFun.showLoading();
                roadConditionDataFun('1006002');
                isShowException = false;
                $.hideLoading("");
            } else {	//显示数据/隐藏数据
                if (!btnFun.isEctive(btn)) {
                    if (planExceptionMarkers) {
                        planExceptionMarkers.hide();
                        wxExceptioPop.close();
                    }
                } else {
                    if (planExceptionMarkers) {
                        planExceptionMarkers.show();
                    } else {
                        $.toast("暂无数据", "cancel");
                    }
                }
            }
        },
        /**事故排障**/
        showAccidentExceptionfun: function (btn) {
            var btn = $(btn).children("img");
            var pgname = btn.attr("src");
            btnFun.toggle(btn);
            if (isLoadAccidentException) {	//第一次加载
                btnFun.showLoading();
                roadConditionDataFun('1006001');
                isShowException = false;
                $.hideLoading("");
            } else {	//显示数据/隐藏数据
                if (!btnFun.isEctive(btn)) {
                    if (accidentExceptionMarkers) {
                        accidentExceptionMarkers.hide();
                        wxExceptioPop.close();
                    }
                } else {
                    if (accidentExceptionMarkers) {
                        accidentExceptionMarkers.show();
                    } else {
                        $.toast("暂无数据", "cancel");
                    }
                }
            }
        },
        /**车辆故障**/
        showVehicleFaultExceptionfun: function (btn) {
            $.toast("系统优化中", "cancel");
        },


    };

    //初始化code
    // let code = getURLParameter("code");
    // let signUrl = window.location.href.split('#')[0];

    /**清空code,openid*/
    function clearCode() {
        //清空code,openid
        u.setStorage("code", "");
        u.setStorage("openid", "");
    }

    //TODO 待删除
    //equipmentList(u.getStorage("openid"));

    /**
     * 图层过滤
     * */
    function filterByZoom(arrayData) {
        if (arrayData == undefined || arrayData == null || arrayData == "") {
            return [];
        }
        if (arrayData.length < 30) {
            return arrayData;
        }
        // arrayData.sort(function (x, y) {//比较函数
        // 	try{
        // 		//return x.equLocation.replace(/[^0-9]/ig,"") - y.index;
        // 		return x.equLocation.replace(/[^0-9]/ig,"") - y.equLocation.replace(/[^0-9]/ig,"")
        // 	} catch (e) {
        // 		return 0;
        // 	}
        //
        // });
        //7,8,9,10,11
        let zoom = Math.floor(map.getZoom());
        let filteredData = [];
        // let equLocationTemp = "";
        let oldSpace = 0;
        if (zoom <= 7) {
            let space = 6;
            arrayData.forEach(function (item, index, array) {

                if (item.space >= oldSpace) {
                    filteredData.push(item);
                    oldSpace = item.space + space;
                } else if (item.space < oldSpace - space) {
                    filteredData.push(item);
                    oldSpace = item.space;
                }
                // if(equLocationTemp == item.equLocation && index % 3 == 0){
                // 	filteredData.push(item);
                // } else if(equLocationTemp != item.equLocation){
                // 	filteredData.push(item);
                // }
                // equLocationTemp = item.equLocation;
            });
        } else if (zoom == 8) {
            let space = 4;
            arrayData.forEach(function (item, index, array) {

                if (item.space >= oldSpace) {
                    filteredData.push(item);
                    oldSpace = item.space + space;
                } else if (item.space < oldSpace - space) {
                    filteredData.push(item);
                    oldSpace = item.space;
                }
                // if(equLocationTemp == item.equLocation && index % 3 == 0){
                // 	filteredData.push(item);
                // } else if(equLocationTemp != item.equLocation){
                // 	filteredData.push(item);
                // }
                // equLocationTemp = item.equLocation;
            });
        } else if (zoom == 9) {
            let space = 2;
            arrayData.forEach(function (item, index, array) {

                if (item.space >= oldSpace) {
                    filteredData.push(item);
                    oldSpace = item.space + space;
                } else if (item.space < oldSpace - space) {
                    filteredData.push(item);
                    oldSpace = item.space;
                }
                // if(equLocationTemp == item.equLocation && index % 2 == 0){
                // 	filteredData.push(item);
                // } else if(equLocationTemp != item.equLocation){
                // 	filteredData.push(item);
                // }
                // equLocationTemp = item.equLocation;
            });
        } else if (zoom == 10) {
            let space = 1;
            arrayData.forEach(function (item, index, array) {

                if (item.space >= oldSpace) {
                    filteredData.push(item);
                    oldSpace = item.space + space;
                } else if (item.space < oldSpace - space) {
                    filteredData.push(item);
                    oldSpace = item.space;
                }
                // if(equLocationTemp == item.equLocation && index % 1 == 0){
                // 	filteredData.push(item);
                // } else if(equLocationTemp != item.equLocation){
                // 	filteredData.push(item);
                // }
                // equLocationTemp = item.equLocation;
            });
        } else {
            //显示所有
            filteredData = arrayData;
        }
        return filteredData;
    }

    // 实例化 AMap.MassMarks
    let massMarks = null;
    let massMarks_video = null;

    /**
     * 1.根据已关注路段获取摄像头数据
     * 2.获取所有路段摄像头数据
     * @param hwId 路段id
     */
    let all_Equipments = {};
    let clickMarker = null;

    function equipmentList(openid) {
        //验证
        if (openid) {
            let url = "";///weixin/map/getEquWWxxAll，/weixin/map/getEquWWxxByHw
            url = "/weixin/map/getEquWWxxByHw";
            axios.post(url, {openid: openid},
                {
                    headers: {
                        "X-Access-Token": u.getStorage("token")
                    }
                }) //也可以直接拼接在url
                .then(function (rs) {
                    $.toptip('摄像头数据加载成功', 2000, 'success');
                    if (all_Equipments) {
                        all_Equipments = {};
                    }
                    if (rs.data.length > 0) {
                        mapBatchMark(rs.data);

                        //轮询告警信息
                        alarmHandle();
                        setInterval(alarmHandle, 60 * 1000);
                        //设置缩放级别和中心点
                        // map.setZoomAndCenter(map$zoom, map$center);
                        u.setStorage("mass-markers", rs.data);
                    } else {
                        url = "/weixin/map/getEquWWxxAll";
                        axios.post(url, {openid: openid},
                            {
                                headers: {
                                    "X-Access-Token": u.getStorage("token")
                                }
                            }) //也可以直接拼接在url
                            .then(function (rs) {
                                if (all_Equipments) {
                                    all_Equipments = {};
                                }
                                mapBatchMark(rs.data);
                                //设置缩放级别和中心点
                                // map.setZoomAndCenter(map$zoom, map$center);
                                u.setStorage("mass-markers", rs.data);

                                //轮询告警信息
                                alarmHandle();
                                setInterval(alarmHandle, 60 * 1000);

                            }).catch(function (e) {
                            $.toptip('摄像头数据请求失败-1', 2000, 'error');
                        });
                    }
                }).catch(function (e) {
                $.toptip('摄像头数据请求失败-0', 2000, 'error');
            });
        } else {
            //isfollowqr(undefined,true,'请关注公众号获取数据','智高速');
        }


    }
    /**点标记*/
    function mapBatchMark(arrayData) {
        if (arrayData.length == 0) {
            return;
        }
        if(all_Equipments){
            for (let value of Object.values(all_Equipments)) {
                value.remove();
            }
        }
        all_Equipments = {};

        let filtData = filterByZoom(arrayData);
        for (let i = 0; i < filtData.length; i++) {
            let marker = new LKMap.Marker({
                position: new LKMap.LngLat(filtData[i]['lnglat'][0], filtData[i]['lnglat'][1]),
                content: '<div class="camimg" id="' + filtData[i].epId + '"></div>',
                offset: new LKMap.Pixel(-0, -0)
            });
            marker.epId = filtData[i].epId;
            marker.equName = filtData[i].equName;
            marker.equLocation = filtData[i].equLocation;
            marker.setMap(map);
            marker.on('click', function (e) {
                wxEquPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                let zoom = Math.floor(map.getZoom());
                if(clickMarker){
                    if (zoom > 6) {
                        $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                    } else {
                        $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                    }
                }

                clickMarker = all_Equipments[e.layer.epId];

                let size = 10;
                if (zoom > 11) {
                    size = 5 * zoom;
                } else {
                    size = 5 * zoom;
                }
                $("#" + filtData[i].epId).css({height: size + 'px', width: size + 'px'});
            });
            all_Equipments[filtData[i].epId] = marker;
        }
    }

    function initHighways() {
        //初始化获取所有路段
        axios.post('/weixin/map/getHighways', {hwId: 0},
            {
                headers: {
                    "X-Access-Token": u.getStorage("token")
                }
            })//也可以直接拼接在url
            .then(function (rs) {
                if (rs.data && rs.data.highways) {
                    u.setStorage("highways", rs.data.highways);
                    $.toptip('路段信息加载成功', 2000, 'success');
                } else {
                    $.toptip('无路段数据', 2000, 'success');
                }
            }).catch(function (e) {
            $.toptip('路段请求失败', 2000, 'error');
        });
    }

    /**
     * 告警处理
     */
    var polylines = [];

    function alarmHandle(showFlg, msg) {
        //初始化获取所有路段
        axios.post('/weixin/map/getWXAlarm', {openid: u.getStorage("openid")},
            {
                headers: {
                    "X-Access-Token": u.getStorage("token")
                }
            })//也可以直接拼接在url
            .then(function (rs) {
                if (rs.data) {
                    let alarms = rs.data.alarms || [];
                    let ends = rs.data.ends;
                    //显示警告点
                    try {
                        markFog = mapBatchMarkFog(alarms);
                    } catch (e) {
                        console.log(e);
                    }
                    try {
                        markFogEnd = mapBatchMarkFogEnd(ends);
                    } catch (e) {
                        console.log(e);
                    }
                    // $.toptip('ALARM TEST','success');
                    if (showFlg && alarms.length == 0) {
                        $.toast(msg, 2000);
                    }
                    /*$.ajax({
                        url: '/weixin/fogTrack/getAlarmTrack',
                        type: 'post',
                        data: {epJson: JSON.stringify(alarms)},
                        dataType: 'json',
                        headers: {
                            "X-Access-Token": u.getStorage("token")
                        },
                        success: function (data) {
                            if (data && data.length > 0) {
                                data.forEach(function (curr, index, arr) {
                                    if (curr.color && curr.track) {
                                        var polyline = polylineFunc(map, curr.track, curr.color);
                                        polylines.push(polyline);
                                    }
                                });
                            }
                        }
                    });*/
                }
            }).catch(function (e) {
            console.log("解析错误");
            console.log(e);
        });
    }

    /**告警标记*/
    let all_alarmInfo = [];

    function mapBatchMarkFog(arrayData1) {
        all_alarmInfo.forEach(function (r) {
            r.setContent('<div class="camimg"></div>');
            let zoom = Math.floor(map.getZoom()); //获取当前地图级别
            // alert(map.getZoom());
            let vs = $(".camimg");
            if (zoom > 6) {
                vs.css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
            } else {
                vs.css({height: '10px', width: '10px'});
            }
            r.on('click', function (e) {
                wxEquPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                let zoom = Math.floor(map.getZoom());
                if(clickMarker){
                    if (zoom > 6) {
                        $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                    } else {
                        $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                    }
                }

                clickMarker = all_Equipments[e.layer.epId];

                let size = 10;
                if (zoom > 11) {
                    size = 5 * zoom;
                } else {
                    size = 5 * zoom;
                }
                $("#" + e.layer.epId).css({height: size + 'px', width: size + 'px'});
            });
        });
        all_alarmInfo = [];
        if (arrayData1.length > 0) {
            arrayData1.sort(function (a, b) {
                return a.distance - b.distance;
            });
        }

        let playFlg = false;

        for (let i = 0; i < arrayData1.length; i++) {
            //渲染告警闪烁
            let tempContent;
            let zIndex = 100;
            if (arrayData1[i].distance == -1) {
                //设备异常
                continue;
            } else if (arrayData1[i].distance < 50) {
                playFlg = true;
                tempContent = "/lkdtWX/img/wumai_red.gif";
                zIndex = 200;
            } else if (arrayData1[i].distance < 100) {
                tempContent = "/lkdtWX/img/wumai_orange.gif";
                zIndex = 199;
            } else if (arrayData1[i].distance < 200) {
                tempContent = "/lkdtWX/img/wumai_yellow.gif";
                zIndex = 198;
            } else {
                tempContent = "/lkdtWX/img/wumai_yellow.gif";
                zIndex = 198;
            }

            //闪烁点渲染
            if (arrayData1[i].distance != -1) {
                if (arrayData1[i].lng && arrayData1[i].lat) {
                    //加载告警闪烁点
                    addCustomMarker(map, tempContent, new LKMap.LngLat(arrayData1[i].lng, arrayData1[i].lat), arrayData1[i].epId, arrayData1[i].equName, zIndex, arrayData1[i].address);
                }
            }
        }
    }

    /**定义闪烁点divMarker*/
    function addCustomMarker(map, content, position, epId, name, zIndex, equLocation) {
        let marker1 = all_Equipments[epId];
        if (marker1) {

            marker1.setContent('<img src="'+content+'" class="camimg" style="background: none;display: block;">');
            let zoom = Math.floor(map.getZoom()); //获取当前地图级别
            // alert(map.getZoom());
            let vs = $(".camimg");
            if (zoom > 6) {
                vs.css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
            } else {
                vs.css({height: '10px', width: '10px'});
            }
            marker1.on('click', function (e) {
                wxEquPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                let zoom = Math.floor(map.getZoom());
                if(clickMarker){
                    if (zoom > 6) {
                        $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                    } else {
                        $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                    }
                }

                clickMarker = all_Equipments[e.layer.epId];

                let size = 10;
                if (zoom > 11) {
                    size = 5 * zoom;
                } else {
                    size = 5 * zoom;
                }
                $("#" + e.layer.epId).css({height: size + 'px', width: size + 'px'});
            });
            all_alarmInfo.push(marker1);
        }

    }

    /**散雾标记*/
    let sanwu_alarmInfo = []

    function mapBatchMarkFogEnd(arrayData1) {
        sanwu_alarmInfo.forEach(function (r) {
            r.setContent('<div class="camimg"></div>');
            let zoom = Math.floor(map.getZoom()); //获取当前地图级别
            // alert(map.getZoom());
            let vs = $(".camimg");
            if (zoom > 6) {
                vs.css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
            } else {
                vs.css({height: '10px', width: '10px'});
            }
            r.on('click', function (e) {
                wxEquPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                let zoom = Math.floor(map.getZoom());
                if(clickMarker){
                    if (zoom > 6) {
                        $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                    } else {
                        $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                    }
                }

                clickMarker = all_Equipments[e.layer.epId];

                let size = 10;
                if (zoom > 11) {
                    size = 5 * zoom;
                } else {
                    size = 5 * zoom;
                }
                $("#" + e.layer.epId).css({height: size + 'px', width: size + 'px'});
            });
        });
        sanwu_alarmInfo = [];
        let arrayData = arrayData1;
        arrayData.forEach(function (r) {
            let marker1 = all_Equipments[r.epId];
            if (marker1) {
                marker1.setContent('<div class="camimg" style="background: url(\'/lkdtWX/plugins/weui/img/wumai_nofog.png\') no-repeat;background-size:100%;"></div>');
                let zoom = Math.floor(map.getZoom()); //获取当前地图级别
                // alert(map.getZoom());
                let vs = $(".camimg");
                if (zoom > 6) {
                    vs.css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                } else {
                    vs.css({height: '10px', width: '10px'});
                }
                sanwu_alarmInfo.push(marker1);
                marker1.on('click', function (e) {
                    wxEquPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                    let zoom = Math.floor(map.getZoom());
                    if(clickMarker){
                        if (zoom > 6) {
                            $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                        } else {
                            $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                        }
                    }

                    clickMarker = all_Equipments[e.layer.epId];

                    let size = 10;
                    if (zoom > 11) {
                        size = 5 * zoom;
                    } else {
                        size = 5 * zoom;
                    }
                    $("#" + e.layer.epId).css({height: size + 'px', width: size + 'px'});
                });
            }
        });
    }

    function confirmPhoneMonual() {
        window.location.replace("/weixin/alarm/confirmPhoneMonual/" + clickepId);
    }

    function manualCorrection() {
        u.setStorage("manualCorrectionBack", "wxMap");
        showDetail("/weixin/alarm/manualCorrection/" + clickepId);
    }

    var date = new Date();
    var hour = date.getHours();
    var dom2 = document.getElementById("container2");
    var myChart2 = echarts.init(dom2);

    let wxWindPop = {
        test: function () {
        },
        /**弹出框*/
        pop: function (equObj) {
            btnFun.showLoading();
            try {
                $('#videoWindow').hide();
                $('#wxWindPopDiv').show();
                var url = encodeURI("/weixin/equipment/lookup/updateWinds/" + equObj.epId)
                $.ajax({
                    type: "post",
                    url: url,
                    headers: {
                        "X-Access-Token": u.getStorage("token")
                    },
                    success(message) {
                        var imgdata = message;
                        var p = imgdata.path;
                        $("#mi").html((imgdata.fMeter || 0).toFixed(1));
                        $("#fengxiang").html(getWindd(imgdata.windd) || '无');
                        $("#windLevel").html(getWindLevel(imgdata.fMeter) || '无');
                        if (imgdata.adjoinEpid) {
                            $src = imgdata.imgpath;
                        } else {
                            $src = ""
                        }
                        $("#windImg").attr("src", $src);
                        /* if(imgdata.fMeter>=200){
                             $("#zhuangtai").html("晴朗");
                        }else if(imgdata.fMeter>=100){
                            $("#zhuangtai").html("大雾");
                        }else if(imgdata.fMeter>=50){
                            $("#zhuangtai").html("浓雾");
                        }else if(imgdata.fMeter>=30){
                            $("#zhuangtai").html("强浓雾");
                        }else if(imgdata.fMeter<30){
                            $("#zhuangtai").html("特强浓雾");
                        } */
                    }
                });
                var date = new Date(new Date().getTime() - 12 * 60 * 60 * 1000).Format('yyyy-MM-dd hh:mm:ss');
                //获取统计图
                $.ajax({
                    type: "get",
                    url: "/weixin/alarm/distanceStatisticWind",
                    dataType: 'json',
                    headers: {
                        "X-Access-Token": u.getStorage("token")
                    },
                    data: {epId: equObj.epId, date: date},
                    success(data) {
                        if (option2 && typeof option2 === "object") {
                            option2.series[0].data = data.intList;
                            option2.xAxis.data = data.xAxis.split(",");
                            myChart2.setOption(option2, false);
                            var intList = data.intList;
                            var minwind = parseFloat(intList[0][2]);
                            var maxwind = parseFloat(intList[0][2]);
                            for (var i = 0; i < data.intList.length; i++) {
                                if (parseFloat(intList[i][2]) < minwind) {
                                    minwind = parseFloat(intList[i][2]);
                                }
                                if (parseFloat(intList[i][2]) > maxwind) {
                                    maxwind = parseFloat(intList[i][2]);
                                }
                            }
                            $("#maxDay").html(maxwind || '0');
                            $("#minDay").html(minwind || '0');
                            $.hideLoading();
                        }
                    }
                });

            } catch (e) {
                $.hideLoading();
                $.toast("ERROR:PO215网络异常", "forbidden");
            }

        },
        close: function () {
            $('#wxWindPopDiv').hide();
        },
    };

    let wxAreaPop = {
        test: function () {
        },
        /**弹出框*/
        pop: function (equObj) {
            btnFun.showLoading();
            try {
                $('#wxAreaPopDiv').show();
                var url = encodeURI("/weixin/lookup/updateWinds/" + equObj.epId)
                $.ajax({
                    type: "post",
                    url: url,
                    headers: {
                        "X-Access-Token": u.getStorage("token")
                    },
                    success(message) {
                        var imgdata = message;
                        var p = imgdata.path;
                        $("#mi").html((imgdata.fMeter || 0).toFixed(1));
                        $("#fengxiang").html(getWindd(imgdata.windd) || '无');
                        $("#windLevel").html(getWindLevel(imgdata.fMeter) || '无');
                        $src = imgdata.imgpath;
                        $("#windImg").attr("src", $src);
                    }
                });
                var date = new Date(new Date().getTime() - 12 * 60 * 60 * 1000).Format('yyyy-MM-dd hh:mm:ss');
                //获取统计图
            } catch (e) {
                $.hideLoading();
                $.toast("ERROR:PO215网络异常", "forbidden");
            }

        },
        jicha: function () {
            window.location.href = '/weixin/map/serveAreaJC';
        },
        fangxiehuo: function () {
            window.location.href = '/weixin/map/serveAreaFXH';
        },
        close: function () {
            $('#wxAreaPopDiv').hide();
        },
    };

    /**
     * 大风测试标记
     * @param map
     */
    let windMarkers = null;
    let pointCollection;//海量点
    function windTestInit() {
        $.ajax({
            url: '/weixin/fogTrack/windTest', type: 'post', data: {hwId: '1'}, dataType: 'json',
            headers: {
                "X-Access-Token": u.getStorage("token")
            },
            success(data) {
                /**批量标记*/
                windMarkers = mapBatchMarkWind(data);
            }
        });
    }


    let all_winds = [];

    function mapBatchMarkWind(arrayDataWind) {
        if (!arrayDataWind.length || arrayDataWind.length == 0) {
            return;
        }
        for (let i = 0; i < arrayDataWind.length; i++) {
            let windUrl = '';
            if (arrayDataWind[i].windLevel == 0) {
                windUrl = "/plugins/windImg/wind-blue.png";
            } else if (arrayDataWind[i].windLevel == 1 || arrayDataWind[i].windLevel == 2) {
                windUrl = "/plugins/windImg/wind-yellow.png";
            } else if (arrayDataWind[i].windLevel == 3 || arrayDataWind[i].windLevel == 4) {
                windUrl = "/plugins/windImg/wind-red.png";
            }
            let marker = new LKMap.Marker({
                position: new LKMap.LngLat(arrayDataWind[i]['lnglat'][0], arrayDataWind[i]['lnglat'][1]),
                content: '<div class="camimg" id="' + arrayDataWind[i].epId + '" style="background: url(\"' + windUrl + '\")"></div>',
                offset: new LKMap.Pixel(-7, -7)
            });
            marker.epId = arrayDataWind[i].epId;
            marker.setMap(map);
            marker.on('click', function (e) {
                wxWindPop.pop(e.layer);//e.layer.equName+" NO."+e.layer.epId
                let zoom = Math.floor(map.getZoom());
                if(clickMarker){
                    if (zoom > 6) {
                        $("#" + clickMarker.epId).css({height: (3 * zoom) + 'px', width: (3 * zoom) + 'px'});
                    } else {
                        $("#" + clickMarker.epId).css({height: '10px', width: '10px'});
                    }
                }
                clickMarker = all_winds[e.layer.epId];

                var size = 10;
                if (zoom > 11) {
                    size = 5 * zoom;
                } else {
                    size = 5 * zoom;
                }
                $("#" + arrayDataWind[i].epId).css({height: size + 'px', width: size + 'px'});
            });
            all_winds[arrayDataWind[i].epId] = marker;
        }
    }

    /**
     * 服务区标记
     * @param map
     */
    let areaMarkers = [];

    function areaTestInit() {
        mapBatchMarkArea([
            {
                "lnglat": [120.769729, 32.291991],
                "epId": "如皋服务区-西侧"
            }
        ]);
        //$.ajax({url:'/fog/fogTrack/windTest',type:'post',data:{hwId:'1'},dataType:'json',
        //	success(data){
        //		/**批量标记*/
        //		areaMarkers = mapBatchMarkArea(data);
        //	}
        //});
    }
    function addGeojsonPolygon() {
        var mapv = new mapvgl.PolyonLayer({
            map: map,
            data: provinceData,
        });
        // 添加图层
        mapv.addLayer({
            id: 'custom—layer-id',  // 自定义图层名字
            style: {
                color: '#80d8ff',
                opacity: 0.4,
                borderColor: '#0091ea',
                showBorder: true,
            },
            zIndex: 100
        });
    }


    function mapBatchMarkArea(arrayDataArea) {
        if (!arrayDataArea.length || arrayDataArea.length == 0) {
            return;
        }
        areaMarkers = [];
        arrayDataArea.forEach(function (item) {
            let marker = new LKMap.Marker({
                position: new LKMap.LngLat(item['lnglat'][0], item['lnglat'][1]),
                content: '<div class="camimg" id="' + item.epId + '" style="background: url(\"/lkdtWX/plugins/weui/img/buttons/fuwuqu.png\")"></div>',
                offset: new LKMap.Pixel(-7, -7)
            });
            marker.epId = item.epId;
            marker.setMap(map);
            marker.on('click', function (e) {
                wxAreaPop.pop(e.layer);
            });
            areaMarkers.push(marker);
        })
    }

    //获取风向
    function getWindd(windd) {
        if (windd > 337.5 || windd <= 22.5) {
            return "北";
        } else if (windd > 22.5 && windd <= 67.5) {
            return "东北";
        } else if (windd > 67.5 && windd <= 112.5) {
            return "东";
        } else if (windd > 112.5 && windd <= 157.5) {
            return "东南";
        } else if (windd > 157.5 & windd <= 202.5) {
            return "南";
        } else if (windd > 202.5 && windd <= 247.5) {
            return "西南";
        } else if (windd > 247.5 && windd <= 292.5) {
            return "西";
        } else if (windd > 292.5 && windd <= 337.5) {
            return "西北";
        }
        return null;
    }

    //获取风向值
    function getWinddVal(windd) {
        if (windd == 4) {
            return "北";
        } else if (windd == 5) {
            return "东北";
        } else if (windd == 6) {
            return "东";
        } else if (windd == 7) {
            return "东南";
        } else if (windd == 0) {
            return "南";
        } else if (windd == 1) {
            return "西南";
        } else if (windd == 2) {
            return "西";
        } else if (windd == 3) {
            return "西北";
        }
        return null;
    }

    //获取风等级
    function getWindLevel(winds) {
        if (winds < 1.5) {
            return "1级";
        } else if (winds <= 3.3) {
            return "2级";
        } else if (winds <= 5.4) {
            return "3级";
        } else if (winds <= 7.9) {
            return "4级";
        } else if (winds <= 10.7) {
            return "5级";
        } else if (winds <= 13.8) {
            return "6级";
        } else if (winds <= 17.1) {
            return "7级";
        } else if (winds <= 20.7) {
            return "8级";
        } else if (winds <= 24.4) {
            return "9级";
        } else if (winds <= 28.4) {
            return "10级";
        } else if (winds <= 32.6) {
            return "11级";
        } else if (winds <= 36.9) {
            return "12级";
        } else if (winds <= 41.4) {
            return "13级";
        } else if (winds <= 46.1) {
            return "14级";
        } else if (winds >= 46.1) {
            return "15级";
        }
        return null;
    }

    var option2 = {
        title: {
            text: '24h风速风向图',
            subtext: '圆的大小和颜色表示风速',
            textStyle: {
                color: '#ffffff',
                fontSize: 18,
            },
            left: 'center'
        },
        grid: {
            x: 45,
            x2: 47,
            y: 70,
            y2: 20
        },
        tooltip: {
            formatter: function (params) {
                return '风速:' + params.value[2] + 'm/s</br>风向:' + getWinddVal(params.value[0]) + '</br>时间:' + params.value[1];
            }
        },
        xAxis: {
            type: 'category',
            name: 'HH:ss',
            data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
            boundaryGap: false,
            axisLine: {
                lineStyle: {
                    color: '#57617B'
                }
            },
            axisLabel: {
                textStyle: {
                    color: '#fff',
                },
            },
            nameTextStyle: {
                color: '#ffffff'
            },
            splitLine: {
                lineStyle: {
                    type: 'dashed'
                }
            }
        },
        yAxis: {
            type: 'value',
            scale: true,
            name: '风向',
            max: 7,
            min: 0,
            interval: 1,
            axisLabel: {
                textStyle: {
                    color: '#fff',
                    fontSize: 14
                },
                rotate: 0,
                formatter: function (value) {
                    if (value == 1) {
                        return '西南';
                    } else if (value == 2) {
                        return '西';
                    } else if (value == 3) {
                        return '西北';
                    } else if (value == 4) {
                        return '北';
                    } else if (value == 5) {
                        return '东北';
                    } else if (value == 6) {
                        return '东';
                    } else if (value == 7) {
                        return '东南';
                    } else if (value == 0) {
                        return '南';
                    }

                }
            },
            axisTick: {
                show: false
            },
            axisLine: {
                lineStyle: {
                    color: '#57617B',

                }
            },
            splitLine: {
                lineStyle: {
                    color: 'rgba(255,255,255,.2)',
                    type: 'dotted',
                }
            },
            nameTextStyle: {
                color: '#ffffff'
            }
        },
        series: [{
            name: 'Punch Card',
            type: 'scatter',
            encode: {
                x: 1,      // 表示维度 3、1、5 映射到 x 轴。
                y: 0,              // 表示维度 2 映射到 y 轴。
                tooltip: [1, 2, 3] // 表示维度 3、2、4 会在 tooltip 中显示。
            },
            symbolSize: function (val) {
                return val[2] * 5;
            },
            animationDelay: function (idx) {
                return idx * 5;
            },
            itemStyle: {
                color: function (val) {
                    var winds = val.data[2];
                    if (winds >= 0 && winds < 10.8) {
                        return '#48ef8b';
                    } else if (winds >= 10.8 && winds < 13.9) {
                        return '#007eff';
                    } else if (winds >= 13.9 && winds < 20.8) {
                        return '#fd4a05';
                    } else if (winds >= 20.8) {
                        return '#ff0000';
                    }
                    return '#fff';

                }
            }
        }]
    };

    //点击案件弹出详情弹出层
    function showDetail(url) {
        //详情页面路径
        $("#rgjzIfram").prop("src", url);
        //weUI弹出层方法
        $("#rgjz").popup();
    }

    //关闭弹出层
    function closePage() {
        //weUI关闭弹出层方法
        $.closePopup();
        //iframe清空内容的办法
        document.getElementById("rgjzIfram").contentWindow.document.body.innerText = "";
    }


    /**微信公众号*/
    let common_options_wx = {...common_options1};
    common_options_wx.xAxis = [{
        type: "category",
        name: "\n\n时间(h)",
        nameGap: 5,
        data: ["23:00", "24:00", "01:00", "02:00", "03:00", "04:00", "05:00"],
        boundaryGap: false,
        axisLine: {
            lineStyle: {
                color: '#57617B'
            }
        },
        axisLabel: {
            textStyle: {
                color: '#fff',
            },
            formatter: function (params) {
                return params.substr(0, 2);
            }
        },
        nameTextStyle: {
            color: '#ffffff'
        }
    }];
    common_options_wx.yAxis = [{
        type: 'value',
        scale: true,
        name: '可见距离(米)',
        max: 700,
        min: 0,
        axisTick: {
            show: false
        },
        axisLine: {
            lineStyle: {
                color: '#57617B',

            }
        },
        axisLabel: {
            margin: 10,
            textStyle: {
                fontSize: 14
            },
            textStyle: {
                color: '#fff',
            },
            formatter: function (params) {
                if (params == 700) {
                    return '>500';
                } else {
                    if (params == 0) {
                        return '';
                    }
                    if (params == 100) {
                        return '30';
                    }
                    if (params == 200) {
                        return '50';
                    }
                    if (params == 300) {
                        return '100';
                    }
                    if (params == 400) {
                        return '200';
                    }
                    if (params == 500) {
                        return '300';
                    }
                    if (params == 600) {
                        return '400';
                    }

                    return params;
                }
            }
        },
        splitLine: {
            lineStyle: {
                color: 'rgba(255,255,255,.2)',
                type: 'dotted',
            }
        },
        nameTextStyle: {
            color: '#ffffff'
        },
        axisPointer: {
            show: false
        }
    }];

</script>
</body>
</html>