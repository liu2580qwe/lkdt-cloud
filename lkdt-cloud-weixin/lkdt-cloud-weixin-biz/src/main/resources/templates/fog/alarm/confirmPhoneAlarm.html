<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <!-- iphone会把一串数字识别为电话号码，点击的时候会提示是否呼叫，屏蔽这功能则把telephone设置为no -->
    <meta content="telephone=no" name="format-detection" />
    <!-- iphone的私有标签，默认值为default（白色），可以定为black（黑色）和black-translucent（灰色半透明） -->
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!-- iphone设备的是有标签 允许全屏模式浏览，隐藏浏览器导航栏 -->
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <!-- 全屏显示 -->
    <meta content="yes" name="apple-touch-fullscreen" />
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- 屏蔽百度转码 -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>告警确认</title>
    <!-- 引入 WeUI -->
	<link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
	<link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
    <style>
        a{text-decoration: none;}
        a:hover{text-decoration: none;}
    </style>
</head>
<body>
	 <div class="weui-gallery" id="gallery">
            <img class="weui-gallery__img" id="galleryImg"></img>
        </div>
	<div class="weui-form">
        <form class="" action="#" id="signupForm">
	        <input id="order"  th:value="${order}"  type="hidden">
			<input id="alarm_id" name="alarmId" th:value="${alarm.alarmId}"  type="hidden">
			<input id="fname" name="fname" type="hidden" th:value="${fname}" />
			<input id="dateStr" name="dateStr" type="hidden" th:value="${dateStr}" />
			<input id="imgtime" name="imgtime" type="hidden" th:value="${alarm.imgtime}" />
			<input id="epId" name="epId" type="hidden" th:value="${alarm.epId}" />
			<input id="oldLevel" name="oldLevel" type="hidden" th:value="${oldLevel}" />
			<input id="level" name="level" type="hidden" th:value="${alarm.level}" />
			<input id="fogType" name="fogType" type="hidden" th:value="${alarm.fogType}" />
			<input id="imgpath" name="imgpath" type="hidden" th:value="${alarm.imgpath}" />
			<input id="iseffective" name="alarmiseffective" type="hidden" th:value="${alarm.iseffective}" />
			<div class="weui-cells weui-cells_form">
	          <div class="weui-cell weui-cell_readonly">
	            <div class="weui-cell__hd"><label class="weui-label">告警摄像头</label></div>
	            <div class="weui-cell__bd">
	                <input class="weui-input" id="equName" name="equName" th:value="${alarm.equName}" readonly/>
	            </div>
	          </div>
	          <div class="weui-cell weui-cell_readonly">
	            <div class="weui-cell__hd"><label class="weui-label">地址</label></div>
	            <div class="weui-cell__bd">
	                <input class="weui-input" id="address" name="address" th:value="${alarm.address}" readonly/>
	            </div>
	          </div>
	          <div class="weui-cell weui-cell_readonly">
	            <div class="weui-cell__hd"><label class="weui-label">开始时间</label></div>
	            <div class="weui-cell__bd">
	                <input class="weui-input" id="begintime" name="begintime" th:value="${#dates.format(alarm.begintime, 'yyyy-MM-dd HH:mm:ss')}"  readonly/>
	            </div>
	          </div>
	          <div class="weui-cell weui-cell_readonly">
	            <div class="weui-cell__hd"><label class="weui-label">消散时间</label></div>
	            <div class="weui-cell__bd">
	                <input class="weui-input" name="endtime" id="endtime" th:value="${#dates.format(alarm.endtime, 'yyyy-MM-dd HH:mm:ss')}"  readonly/>
	            </div>
	          </div>
	          <div class="weui-cell weui-cell_readonly">
	            <div class="weui-cell__hd"><label class="weui-label">告警类型</label></div>
	            <div class="weui-cell__bd">
	                <input class="weui-input" name="alarmtypetext" id="alarmtypetext" readonly/>
	            </div>
	          </div>
	          <div class="weui-cell weui-cell_readonly">
	            <!-- <div class="weui-cell__hd"><label class="weui-label">告警图片</label></div> -->
	            <div class="weui-cell__bd">
	                <img class='weui-jiaj-img' id='img1' alt="" onerror="this.src='/img/defalt.jpg;this.onerror=null'" onclick="imgclick()" style="width: 100%;height: 200px;"/>
	            </div>
	          </div>
	        <div class="weui-cells weui-cells_radio">
	          	<div class="weui-cell__hd"><label class="weui-label">通知类型</label></div>
	            <label class="weui-cell weui-check__label" for="x14">
	                <div class="weui-cell__bd">
	                    <p>有效</p>
	                </div>
	                <div class="weui-cell__ft">
	                    <input type="radio" class="weui-check" th:field="${alarm.iseffective}"
									name="iseffective" value="1" id="x14"/>
	                    <span class="weui-icon-checked"></span>
	                </div>
	            </label>
	            <label class="weui-cell weui-check__label" for="x15">
	
	                <div class="weui-cell__bd">
	                    <p>无效</p>
	                </div>
	                <div class="weui-cell__ft">
	                    <input type="radio" class="weui-check" th:field="${alarm.iseffective}"
									name="iseffective" value="0" id="x15"/>
	                    <span class="weui-icon-checked"></span>
	                </div>
	            </label>
	        </div>
	        <div class="weui-cell" id="js_cell">
	            <div class="weui-cell__hd"><label class="weui-label">可见距离</label></div>
		            <div class="weui-cell__bd">
		                <input class="weui-input" autofocus type="number" pattern="[0-9]*" placeholder="请输入可见距离" id="distance" name="distance" th:value="${alarm.distance}" onchange="distancechange()"/>
		                </button>
		            </div>
	          </div>
	        </div>
            
        </form>
        <a href="javascript:;" class="weui-btn weui-btn_primary" onclick="primaryClick()" id="submit">点击提交</a>
        <!-- <div class="weui-form">
		    <div class="weui-form__control-area">
		      <div class="weui-cells__group weui-cells__group_form">
		        <div class="weui-cells__title">通知文本</div>
		        <div class="weui-cells weui-cells_form">
		            <div class="weui-cell">
		                <div class="weui-cell__bd">
		                    <textarea class="weui-textarea" id="smtext" name="smtext" rows="3"></textarea>
		                </div>
		            </div>
		        </div>
		      </div>
		    </div>
	  </div> -->
	</div>
    <!-- 引入 WeJS -->
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <script>
        //返回
        function bindBack(){
            window.close();
        }

        /**提交*/
        function primaryClick(){
            //参数
            $.ajax({
        		type : "POST",
        		url : "/system/alarm/confirm2",
        		data : $('#signupForm').serialize(),// 你的formid
        		error : function(request) {
        			 $.toast("网络异常", "cancel");
        		},
        		success : function(data) {
        			if (data.code == 0) {
        				$.alert("发送成功", function() {
             				  //点击确认后的回调函数
                           	$("#submit").attr("onclick","");
                       		$("#submit").text("已确认");
                               window.close();
           				});
        				

        			} else {
        				$.toast("发送失败", "cancel");
        			}

        		}
        	});
        }

        var iseffect=1;
        var imgpath='';
        $().ready(function() {
        	document.getElementById("distance").select();
        	var fname=$("#fname").val();
        	$("#imgpath").val($("#fname").val());
        	var dateStr=$("#dateStr").val();
        	if(distance>=200){
				imgpath = fname;
			} else {
				imgpath = fname;
			}
        	$("#img1").attr("src",imgpath);
        	$("#galleryImg").attr("src",imgpath);
        	var address=$("#address").val();
        	var distance=$("#distance").val();
        	var equName=$("#equName").val();
       		document.getElementsByName('iseffective')[0].setAttribute("checked","checked");
        	var oldLevel=$("#oldLevel").val();
        	var level=$("#level").val();
        	// 1:发生告警  2：告警等级增加  3：告警等级减少    4：告警解除
        		$("#alarmtypetext").val("发生告警");
//        		$("#alarmtype").val(1);
        	if(distance>=200){
        		$("#alarmtypetext").val("告警解除");
//        		$("#alarmtype").val(4);
        	}
        		
        	//th:src="@{{path}(path=${alarm.imgpath})}"
        });
        function getLevelDesc(level){
        	if(level==0){
        		return "无管制";
        	}
        	if(level==1){
        		return "三级管制";
        	}
        	if(level==2){
        		return "二级管制";
        	}
        	if(level==3){
        		return "特级管制";
        	}
        }
        function distancechange(){
        	/* var address=$("#address").val();
        	var distance=$("#distance").val();
        	var equName=$("#equName").val();
        	if(distance>200){
        		$("#alarmtypetext").val("告警解除");
        		document.getElementsByName('alarmtype')[2].setAttribute("checked","checked");
//        		$("#alarmtype").val(4);
        	}else{
        		document.getElementsByName('alarmtype')[1].setAttribute("checked","");
        	} */
        }
        function getLevel(distance){
        	var level='';
        	if(distance<=200){
        		level= "三";
        	}
        	if(distance<=100){
        		level= "二";
        	}
        	if(distance<=50){
        		level= "一";
        	}
        	if(distance<=30){
        		level= "特";
        	}
        	return level;
        }
        function getfogLevel(distance){
        	var fogLevel='';
        	if(distance<=200){
        		fogLevel= "大雾";
        	}
        	if(distance<=100){
        		fogLevel= "浓雾";
        	}
        	if(distance<=50){
        		fogLevel= "特浓雾";
        	}
        	if(distance<=30){
        		fogLevel= "特大浓雾";
        	}
        	return fogLevel;
        }
        
        function imgclick(){
        	 	$gallery = $("#gallery");
        	 	$gallery.fadeIn(100);
        	 	$gallery.on("click", function(){
                    $gallery.fadeOut(100);
                });
        	  // $('.weui-gallery__del').remove();
        	}


    </script>
</body>
</html>